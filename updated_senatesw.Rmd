---
title: "updated_senatesw.Rmd"
author: "lizzie tucker and Prof. Wendy Tam"
last updated: "2025-12-26"
output: html_document
---

```{r setup, include=TRUE}
# Load required packages
library(sna)
library(igraph)
```

```{r}
## read in the data

# core vectors
sponsors   <- scan("sponsors.vec", what = integer(), quiet = TRUE)
years      <- scan("years.vec", what = integer(), quiet = TRUE)
numchamber <- scan("chamber.vec", what = integer(), quiet = TRUE)

# cosponsor vector
cosponsors_raw <- readLines("cosponsors.vec")
cosponsors_raw <- cosponsors_raw[-1]               # drop first blank line
cosponsors_raw[cosponsors_raw == "NA"] <- ""       # normalize NA -> empty

if (length(cosponsors_raw) > length(sponsors)) {
  cosponsors_raw <- cosponsors_raw[1:length(sponsors)]
}
cosponsors <- cosponsors_raw

sponsor_party   <- readLines("sponsor_party.vec")
cosponsors_party <- readLines("cosponsors_party.vec")

# cheatsheet for ICPSR -> name
icpsr_house <- read.csv("ICPSR_senate_cheatsheet.csv", stringsAsFactors = FALSE)

# standardizing cheatsheet columns
names(icpsr_house) <- tolower(names(icpsr_house))
icpsr_house$icpsr <- as.integer(icpsr_house$icpsr)
icpsr_house$name  <- trimws(icpsr_house$name)

icpsr_to_name <- setNames(icpsr_house$name, as.character(icpsr_house$icpsr))

# length checks (everything that should align with bills)
lens <- c(
  sponsors = length(sponsors),
  years = length(years),
  numchamber = length(numchamber),
  cosponsors = length(cosponsors),
  sponsor_party = length(sponsor_party),
  cosponsors_party = length(cosponsors_party)
)
print(lens)

if (!(lens["sponsors"] == lens["years"] &&
      lens["years"] == lens["numchamber"] &&
      lens["numchamber"] == lens["cosponsors"] &&
      lens["cosponsors"] == lens["sponsor_party"] &&
      lens["sponsor_party"] == lens["cosponsors_party"])) {
  stop("ERROR: One or more vectors are not the same length. See printed lengths above.")
}
```

```{r}
## AFTER THIS ONLY SENATE BILLS EXIST IN THIS FILE
# separate bills into house and senate (H=2, S=1 in numchamber)
# house is length 52891

senate_idx <- which(numchamber == 1)
ss            <- sponsors[senate_idx]
scs           <- cosponsors[senate_idx]
syears        <- years[senate_idx]
ss_party      <- sponsor_party[senate_idx]
scs_party     <- cosponsors_party[senate_idx]

```

```{r}
## Calculates Senate Productivity Percentages for Each Congress 108-118
library(readxl)
library(stringr)

# Constants pulled from data folders
congresses <- 108:118

total_S <- c(
  `108` = 3035,
  `109` = 4122,
  `110` = 3741,
  `111` = 4059,
  `112` = 3716,
  `113` = 3020,
  `114` = 3548,
  `115` = 3805,
  `116` = 5086,
  `117` = 5357,
  `118` = 5649
)

# helper: Counts non-empty entries in each congress column 
count_entries_by_congress <- function(path, congresses = 108:118) {
  df <- read_excel(path)

  vapply(congresses, function(cg) {
    col <- as.character(cg)
    if (!col %in% names(df)) return(0L)

    x <- as.character(df[[col]])
    sum(!is.na(x) & str_trim(x) != "")
  }, integer(1))
}

# Pulls counts from Senate spreadsheets
total_commemorative <- count_entries_by_congress(
  "significance_encodings/CListSenate.xlsx",
  congresses
)

total_subsig <- count_entries_by_congress(
  "significance_encodings/SSListSenate.xlsx",
  congresses
)

# Calculates percentages and substantive total
total_substantive <- total_S - (total_subsig + total_commemorative)

percentage_com         <- total_commemorative / total_S
percentage_subsig      <- total_subsig / total_S
percentage_substantive <- total_substantive / total_S

# Example single variable use
# total_commemorative["108"]
# total_subsig["115"]
# percentage_substantive["118"]
```

```{r}
library(ggplot2)
library(tidyr)
library(scales)

# Build plotting dataframe from existing variables
plot_df <- data.frame(
  congress = congresses,
  commemorative = percentage_com,
  subsignificant = percentage_subsig,
  substantive = percentage_substantive
)

# Reshape for ggplot
plot_long <- pivot_longer(
  plot_df,
  cols = -congress,
  names_to = "category",
  values_to = "percentage"
)

# Labels
plot_long$category <- factor(
  plot_long$category,
  levels = c("substantive", "subsignificant", "commemorative"),
  labels = c("Substantive", "Substantive and Significant", "Commemorative")
)

# Plot
ggplot(plot_long, aes(x = congress, y = percentage, color = category)) +
  geom_line(linewidth = 1.2) +
  geom_point(size = 2) +
  scale_x_continuous(breaks = congresses) +
  scale_y_continuous(labels = percent_format()) +
  labs(
    title = "Senate Productivity by Congress (108â€“118)",
    x = "Congress",
    y = "Share of Bills",
    color = "Bill Type"
  ) +
  theme_minimal(base_size = 13)

```
